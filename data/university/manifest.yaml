entities:
  - name: Student
    role: leaf
    detail: true
    estimated_rows: 30
    metrics:
      - name: tuition_paid
        type: currency
        nature: additive
      - name: satisfaction_score
        type: rating
        nature: non-additive

  - name: Class
    role: bridge
    detail: true
    estimated_rows: 10
    metrics:
      - name: class_budget
        type: currency
        nature: additive

  - name: Professor
    role: leaf
    detail: true
    estimated_rows: 5
    metrics:
      - name: salary
        type: currency
        nature: additive

relationships:
  - name: Enrollment
    between: [Student, Class]
    type: many-to-many
    estimated_links: 90

  - name: Assignment
    between: [Class, Professor]
    type: many-to-many
    estimated_links: 13

# Metrics default to reserve (no propagation needed).
# Only non-reserve metrics are listed here.
propagations:
  # tuition_paid (Student) allocates outward through Enrollment to Class,
  # then through Assignment to Professor. Each hop has its own weight.
  - metric: tuition_paid
    path:
      - relationship: Enrollment
        target_entity: Class
        strategy: allocation
        weight: enrollment_share
      - relationship: Assignment
        target_entity: Professor
        strategy: allocation
        weight: assignment_share

  # class_budget (Class) uses elimination toward Student — every student row
  # shows the full class budget, reserve row cancels the overcount.
  # Does not propagate to Professor (reserve by default).
  - metric: class_budget
    path:
      - relationship: Enrollment
        target_entity: Student
        strategy: elimination

  # salary (Professor) stays reserve for all foreign entities.
  # Not listed here — reserve is the default.

  # satisfaction_score (Student) uses sum_over_sum toward Class.
  # Does not propagate to Professor (reserve by default).
  - metric: satisfaction_score
    path:
      - relationship: Enrollment
        target_entity: Class
        strategy: sum_over_sum
        weight: satisfaction_weight

bft_tables:
  # Full grain: Student × Class × Professor
  # Includes tuition (allocated through both hops), class_budget (eliminated
  # toward students), salary (reserve). satisfaction_score not included here
  # because its path doesn't reach Professor.
  - name: department_financial
    metrics: [tuition_paid, class_budget, salary]

  # Grain: Student × Class (satisfaction propagates to Class, class_budget
  # eliminates toward Student). Excludes tuition_paid because its multi-hop
  # path would pull Professor into the grain.
  - name: student_experience
    metrics: [satisfaction_score, class_budget]
